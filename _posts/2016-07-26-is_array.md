---
layout: default

title: 判断数组（类型）

theme: JavaScript
---

#### JavaScript中判断数组的正确姿势

在Javascript中，如何判断一个变量是否是数组？

最好的方式是用ES5提供的`Array.isArray()`，毕竟原生的才是最屌的

```javascript
var a = [0, 1, 2];
console.log(Array.isArray(a));  // true
```

但是低版本IE不支持ES5，如果需要兼容，需要想想别的办法。



#### What about `typeof`?

数组是一个特殊的对象，所以数组的typeof结果也是object，而因为null的结构也是object，所以如需用typeof运算符来判断数组，需要这么写。

```javascript
var a = [0, 1, 2];
console.log(typeof a === 'object' && a !== null && Object.prototype.toString.call(a) !== '[object Object]'); // true
```



#### What about `instanceof`? 

来回忆一下instanceof运算符的使用方式。a instance of b，如果返回true，表示a是b的一个实例。那么如果a instanceof Array返回true，是不是就说明a是数组类型呢？跟instanceof师出同门的还有constructor，是否同样可以判断呢？

```
var a = [0, 1, 2];
console.log(a instanceof Array);  // true 数组？
console.log(a.constructor === Array);  // true 数组？
```

大部分情况下是可以的，但是在跨frame的情况下，实例化的对象彼此不共享原型链。



#### 特性嗅探？

```
var a = [0, 1, 2];
if (a.sort) {
  ... // 是数组
}
```

也不靠谱，万一某个对象正好有值为sort的key呢？



#### 前方高能

最正确的姿势是用Object.prototype.toString()判断：

```
var a = [0, 1, 2];

console.log(Object.prorotype.toString.call(a) === '[object Array]'); // true
```

事实上，这也是一些类库进行数组（甚至其他类型）判断的主流方式。

比如在jQuery中进行数组判断的相关代码（PS: 摘自jQuery 1.10.1，最近版本的jQuery只保留列Array.isArray()，没有对不支持ES5的浏览器做兼容）：

```javascript
isArray: Array.isArray || function (obj) {
  return jQuery.type(obj)  === 'array';
},

type: function (obj) {
  if (obj === null) {
    return String(obj);
  }
  return typeof obj === 'object' || typeof obj === 'function '?
    class2type[ core_toString.call(obj) ] || 'object' :
    typeof (obj);
},
jQuery.each('Boolean Number String Function Array Date RegExp Object Error'.split(' '), function (i, name) {
  class2type['[object ' + name + ']'] = name.toLowerCase();
});
```



#### 为什么Object.prototype.toString()可以返回这样类型的字符串？

`ECMA-262`

规范定义了Object.prototype.toString的行为：首先，取得对象的一个内部属性[[Class]]，然后依据这个属性，返回一个类似于'[object Array]'的字符串作为结果（[[]]用来表示语言内部用到的、外部不可直接访问的属性，称为"内部属性"）。利用这个方法，再配合call，我们可以取得任何对象的内部属性[[Class]]，然后把类型检测转化为字符串比较，以达到我们的目的。还是先来看看在ECMA标准中Array的描述吧。